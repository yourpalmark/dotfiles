# ─── SHELL & BASICS ────────────────────────────────────
set -g default-command /opt/homebrew/bin/fish
set -g default-shell /opt/homebrew/bin/fish
set -g mouse on

# ─── PREFIX KEY ────────────────────────────────────────
# Change prefix from Ctrl+b to Ctrl+Space
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# ─── QUALITY OF LIFE ───────────────────────────────────
# Start window/pane numbering at 1 (0 is far from your fingers)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed (no gaps)
set -g renumber-windows on

# Longer scrollback history (default is 2000)
set -g history-limit 50000

# Faster escape time (helps with vim/neovim)
set -sg escape-time 10

# Enable focus events (for vim autoread etc)
set -g focus-events on

# Better colors (if your terminal supports it)
set -g default-terminal "screen-256color"
set -sa terminal-features ',xterm-256color:RGB'

# ─── EASIER PANE SPLITTING ─────────────────────────────
# Split with | and - (more intuitive than % and ")
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# New windows/panes open in current directory (not home)
bind c new-window -c "#{pane_current_path}"

# ─── PANE NAVIGATION (vim-style) ───────────────────────
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ─── EASY CONFIG RELOAD ────────────────────────────────
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# ─── VI COPY MODE ──────────────────────────────────────
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection          # v = start visual
bind -T copy-mode-vi C-v send -X rectangle-toggle       # Ctrl+v = block select
bind -T copy-mode-vi V send -X select-line              # V = select line
bind -T copy-mode-vi y send -X copy-selection-and-cancel  # y = copy to tmux buffer
bind -T copy-mode-vi C-c send -X copy-pipe-and-cancel "pbcopy"  # Ctrl+c = copy to system clipboard
bind -T copy-mode-vi Escape send -X cancel              # Escape = exit

# ─── MOUSE SELECTION → SYSTEM CLIPBOARD ────────────────
# When you finish mouse-dragging, auto-copy to system clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "pbcopy"

# Also allow mouse selection outside of copy-mode to work
bind -n MouseDragEnd1Pane if-shell -F -t= '#{mouse_any_flag}' 'send -M' 'copy-mode -M'

# ─── PASTE BUFFER ──────────────────────────────────────
bind p paste-buffer                                      # Ctrl+Space p = paste
bind P choose-buffer                                     # Ctrl+Space P = pick from history
bind C-p run-shell "pbpaste | tmux load-buffer - ; tmux paste-buffer"  # Ctrl+Space Ctrl+p = paste from system clipboard

# ─── PLUGINS ───────────────────────────────────────────
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Auto-restore sessions on tmux start
set -g @continuum-restore 'on'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
